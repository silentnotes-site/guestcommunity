<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Guest Community</title>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.2/dist/gsap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    html, body { width:100%; height:100%; font-family:'Outfit',sans-serif;
      background: linear-gradient(to right,#0f0c29,#302b63,#24243e);
      overflow:hidden; color:#fff; }
    #ring-intro {
      position:fixed; top:0; left:0; width:100vw; height:100vh;
      background:#0f0c29; display:flex; align-items:center;
      justify-content:center; flex-direction:column; z-index:9999;
    }
    #ring-text { font-size:6rem; font-weight:700; letter-spacing:.3em;
      color:#25d366; text-shadow:0 0 20px #25d366cc; opacity:0; }
    #ring-subtext { margin-top:1rem; font-size:1.4rem; color:#aaa; opacity:0; }
    #main-site { display:none; position:relative; z-index:2;
      height:100vh; overflow-y:auto; padding-bottom:60px; }
    header {
      position:sticky; top:0; background:rgba(0,0,0,0.5);
      backdrop-filter:blur(6px); padding:1rem 3rem;
      display:flex; justify-content:space-between; align-items:center;
      z-index:10;
    }
    header h1 { font-size:1.8rem; user-select:none; }
    nav { display:flex; gap:1.5rem; flex-wrap:wrap; }
    nav a {
      color:#ccc; font-weight:600; cursor:pointer; text-decoration:none;
      padding-bottom:4px; border-bottom:2px solid transparent;
      transition:color .3s,border-color .3s;
    }
    nav a:hover, nav a.active {
      color:#25d366; border-bottom-color:#25d366;
    }
    main { max-width:900px; margin:80px auto 40px; padding:0 20px; }
    section { display:none; }
    section.active { display:block; }
    h2 { margin-bottom:1rem; user-select:none; }
    button {
      background:#25d366; border:none; border-radius:30px;
      padding:1rem 2rem; font-size:1.2rem; color:#fff;
      cursor:pointer; box-shadow:0 6px 15px #25d366aa;
      margin-top:1.5rem; user-select:none; transition:background .3s;
    }
    button:hover { background:#1da851; }
    input#news-search {
      width:100%; padding:.5rem 1rem; font-size:1rem;
      border-radius:10px; border:none; margin-bottom:1rem;
    }
    #news-container {
      display:flex; flex-direction:column; gap:1.5rem;
    }
    .news-item {
      background:rgba(37,211,102,0.1); border-radius:10px;
      padding:1rem; display:flex; gap:1rem; color:#ddd;
    }
    .news-image {
      width:150px; height:100px; border-radius:10px;
      object-fit:cover; flex-shrink:0; background:#111;
    }
    .news-content {
      flex:1; display:flex; flex-direction:column;
    }
    .news-title {
      font-weight:700; font-size:1.1rem; color:#25d366;
      margin-bottom:.3rem; user-select:none;
    }
    .news-description { font-size:.9rem; margin-bottom:.3rem; }
    .news-date {
      font-size:.8rem; color:#aaa; margin-bottom:.5rem;
      user-select:none;
    }
    .news-excerpt {
      font-size:.85rem; color:#ccc; flex-grow:1; user-select:text;
    }
    .news-link {
      align-self:flex-start; margin-top:.5rem; font-weight:600;
      color:#25d366; text-decoration:none; user-select:none;
    }
    .news-link:hover { text-decoration:underline; }
    #events-list {
      list-style:none; padding:0;
    }
    .event-item {
      background:rgba(255,255,255,0.1); border-radius:10px;
      padding:1rem; margin-bottom:1rem;
    }
    #contact-form input,#contact-form textarea {
      width:100%; padding:.8rem 1rem; border-radius:10px;
      border:none; font-size:1rem; resize:vertical;
      margin-bottom:1rem;
    }
    footer {
      text-align:center; padding:2rem 0; color:#aaa;
      background:rgba(0,0,0,0.5);
    }
  </style>
</head>
<body>

<div id="ring-intro">
  <div id="ring-text">Guest Community</div>
  <div id="ring-subtext">Caricamento in corso...</div>
</div>

<div id="main-site" tabindex="0">
  <header>
    <h1>Guest Community</h1>
    <nav>
      <a class="nav-link active" data-section="home">Home</a>
      <a class="nav-link" data-section="meteo">Meteo</a>
      <a class="nav-link" data-section="notizie">Notizie</a>
      <a class="nav-link" data-section="ora">Ora</a>
      <a class="nav-link" data-section="eventi">Eventi</a>
      <a class="nav-link" data-section="contatti">Contatti</a>
    </nav>
  </header>

  <main>
    <section id="home" class="active">
      <h2>Benvenuto nella Guest Community</h2>
      <p>Unisciti al gruppo WhatsApp per condividere idee, risorse e nuove esperienze.</p>
      <button onclick="window.open('https://chat.whatsapp.com/I9Tw0sIS8ulDD9djqYav36','_blank')">Unisciti al gruppo</button>
    </section>

    <section id="meteo">
      <h2>Meteo</h2>
      <p id="meteo-info">Caricamento meteo...</p>
    </section>

    <section id="notizie">
      <h2>Ultime notizie</h2>
      <input id="news-search" placeholder="Cerca notizie..." autocomplete="off" />
      <p id="news-info">Caricamento notizie...</p>
      <div id="news-container"></div>
    </section>

    <section id="ora">
      <h2>Ora attuale</h2>
      <p id="time-info">Caricamento ora...</p>
      <p id="timezone-info"></p>
    </section>

    <section id="eventi">
      <h2>Eventi prossimi</h2>
      <ul id="events-list"></ul>
    </section>

    <section id="contatti">
      <h2>Contattaci</h2>
      <form id="contact-form" action="https://api.web3forms.com/submit" method="POST">
        <input type="hidden" name="access_key" value="9a9e0334-0522-4e37-b34d-7f64d72c463f" />
        <input type="text" name="name" placeholder="Nome completo" required />
        <input type="email" name="email" placeholder="Email" required />
        <textarea name="message" placeholder="Messaggio" required></textarea>
        <button type="submit">Invia messaggio</button>
      </form>
    </section>
  </main>

  <footer>© 2025 Guest Community • Powered by WebMagix</footer>
</div>

<script>
(() => {
  const ringText = document.getElementById('ring-text'), ringSubtext = document.getElementById('ring-subtext');
  gsap.to(ringText,{opacity:1,duration:1}); 
  gsap.to(ringSubtext,{opacity:1,duration:1,delay:0.5});
  setTimeout(()=>{
    gsap.to([ringText,ringSubtext],{opacity:0,duration:1});
    gsap.to('#ring-intro',{opacity:0,duration:1,delay:0.5,onComplete:()=>{
      document.getElementById('ring-intro').remove(); startApp();
    }});
  },3500);

  function startApp(){
    const mainSite = document.getElementById('main-site');
    mainSite.style.display='block';
    gsap.to(mainSite,{opacity:1,duration:1.5});
    const navLinks=document.querySelectorAll('.nav-link'), sections=document.querySelectorAll('main section');
    navLinks.forEach(l=>l.addEventListener('click',()=>{
      navLinks.forEach(x=>x.classList.remove('active'));
      l.classList.add('active');
      const tgt = l.getAttribute('data-section');
      sections.forEach(s=>s.classList.toggle('active',s.id===tgt));
    }));

    function weatherCodeToDesc(c){ 
      const map={
        0:"Sereno",1:"Parz. nuvoloso",2:"Nuvoloso",3:"Coperto",
        45:"Nebbia",48:"Nebbia brina",51:"Pioggerella",
        61:"Pioggia",71:"Neve",95:"Temporale",99:"Grandine"
      };
      return map[c]||"Sconosciuto";
    }

    async function fetchMeteo(){
      const info=document.getElementById('meteo-info');
      if(!navigator.geolocation){
        info.textContent="Geolocalizzazione non supportata";
        return;
      }
      navigator.geolocation.getCurrentPosition(async pos=>{
        try{
          const lat=pos.coords.latitude.toFixed(2), lon=pos.coords.longitude.toFixed(2);
          const res=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&temperature_unit=celsius&timezone=auto`);
          const data=await res.json(), w=data.current_weather;
          info.textContent=`${w.temperature}°C, ${weatherCodeToDesc(w.weathercode)}, vento ${w.windspeed} km/h`;
        }catch{
          info.textContent="Errore caricamento meteo";
        }
      },()=>{
        info.textContent="Geolocalizzazione negata";
      });
    }

    let debounce;
    async function fetchNotizie(q='tecnologia'){
      const info=document.getElementById('news-info'), cont=document.getElementById('news-container');
      info.textContent="Caricamento notizie...";
      cont.innerHTML='';
      try{
        const res=await fetch(`https://gnews.io/api/v4/search?q=${encodeURIComponent(q)}&lang=it&max=8&token=d5952ce4e39cd92ee61ea088973969a4`);
        const data=await res.json();
        if(!data.articles?.length){
          info.textContent="Nessuna notizia trovata";
          return;
        }
        const filtered = data.articles.filter(a => a.image && a.description);
        if(!filtered.length){
          info.textContent = "Nessuna notizia rilevante trovata";
          return;
        }
        info.textContent='';
        filtered.forEach(a=>{
          const item=document.createElement('div');
          item.className='news-item';
          item.innerHTML=`
            <img class="news-image" src="${a.image}" alt="">
            <div class="news-content">
              <div class="news-title">${a.title}</div>
              <div class="news-description">${a.description}</div>
              <div class="news-date">${new Date(a.publishedAt).toLocaleString("it-IT",{dateStyle:"medium",timeStyle:"short"})}</div>
              <div class="news-excerpt">${a.content ? a.content.split('[')[0] : ''}</div>
              <a class="news-link" href="${a.url}" target="_blank">Leggi di più</a>
            </div>
          `;
          cont.appendChild(item);
        });
      }catch{
        info.textContent="Errore caricamento notizie";
      }
    }
    document.getElementById('news-search').addEventListener('input', e=>{
      clearTimeout(debounce);
      const q=e.target.value.trim() || 'tecnologia';
      debounce = setTimeout(()=>fetchNotizie(q), 500);
    });

    function updateTime(){
      document.getElementById('time-info').textContent=new Date().toLocaleTimeString();
      document.getElementById('timezone-info').textContent=Intl.DateTimeFormat().resolvedOptions().timeZone;
    }

    async function fetchEventi(){
      const ul=document.getElementById('events-list');
      ul.innerHTML='';
      try{
        const res=await fetch('https://www.eventbriteapi.com/v3/events/search/?location.address=Italia&token=SEGG3AN4HDFPIIB6WRQG');
        const data=await res.json();
        if(!data.events || !data.events.length){
          ul.innerHTML='<li class="event-item">Nessun evento trovato</li>';
          return;
        }
        data.events.slice(0,5).forEach(ev=>{
          const li=document.createElement('li');
          li.className='event-item';
          li.innerHTML = `<strong>${ev.name.text}</strong><br>`+
                         `${new Date(ev.start.local).toLocaleDateString("it-IT",{dateStyle:"medium",timeStyle:"short"})}<br>`+
                         `${ev.venue_id ? 'Luogo ID: '+ev.venue_id : ''}`;
          ul.appendChild(li);
        });
      }catch{
        ul.innerHTML='<li class="event-item">Errore caricamento eventi</li>';
      }
    }

    document.getElementById('contact-form').addEventListener('submit', e=>{
    });

    fetchMeteo();
    fetchNotizie();
    updateTime();
    setInterval(updateTime,1000);
    fetchEventi();
  }
})();
</script>

</body>
</html>
